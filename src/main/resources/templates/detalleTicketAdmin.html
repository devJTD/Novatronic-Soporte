<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Novatronic - Detalle Ticket Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="/css/nova-styles.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-glass fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="/admin/dashboard">
                <img src="/img/logo.png" alt="Novatronic">
                <span class="badge bg-danger ms-2">ADMIN</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item"><a class="nav-link" href="/admin/dashboard"><i class="bi bi-speedometer2"></i> Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link active" href="/admin/tickets-revisados"><i class="bi bi-list-check"></i> Gestión Tickets</a></li>
                    <li class="nav-item"><a class="nav-link" href="/admin/reportes"><i class="bi bi-graph-up"></i> Reportes</a></li>
                    <li class="nav-item"><a class="nav-link" href="/admin/base-conocimiento"><i class="bi bi-book"></i> Base Conocimiento</a></li>
                </ul>
                <div class="d-flex align-items-center">
                    <span class="text-white me-3"><i class="bi bi-person-circle"></i> Admin</span>
                    <a class="btn btn-sm btn-nova btn-nova-danger" href="/login"><i class="bi bi-box-arrow-right"></i> Salir</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="main-content">
        <nav class="mb-4">
            <ol class="breadcrumb" style="background: transparent;">
                <li class="breadcrumb-item"><a href="/admin/dashboard" class="text-white">Dashboard</a></li>
                <li class="breadcrumb-item"><a href="/admin/tickets-revisados" class="text-white">Gestión Tickets</a></li>
                <li class="breadcrumb-item active text-glass-muted">NOV-3421</li>
            </ol>
        </nav>

        <div class="flex justify-between items-start mb-6">
            <div>
                <h1 class="text-4xl font-bold text-white mb-3">
                    <i class="bi bi-ticket-detailed-fill"></i> Ticket NOV-3421
                </h1>
                <h2 class="text-2xl text-glass-muted mb-3">Caída total del sistema de pagos</h2>
                <div class="flex gap-3">
                    <span class="badge-modern badge-critica">CRÍTICA</span>
                    <span class="badge-modern badge-media">EN PROCESO</span>
                    <span class="badge-modern" style="background: rgba(255,255,255,0.1); color: white;">
                        <i class="bi bi-tag"></i> Incidente - Pagos
                    </span>
                </div>
            </div>
            <a href="/admin/tickets-revisados" class="btn btn-nova" style="background: rgba(255,255,255,0.1); color: white;">
                <i class="bi bi-arrow-left"></i> Volver
            </a>
        </div>

        <!-- Req 9: Medición de Tiempos SLA -->
        <div class="alert-glass alert-glass-danger mb-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <i class="bi bi-alarm-fill text-5xl"></i>
                    <div>
                        <h4 class="font-bold text-2xl mb-1">SLA EN RIESGO CRÍTICO</h4>
                        <p class="mb-1">Tiempo restante para resolución: <strong class="text-3xl">8 minutos</strong></p>
                        <div class="flex gap-4 text-sm">
                            <div><i class="bi bi-clock-history"></i> Tiempo transcurrido: 52 minutos</div>
                            <div><i class="bi bi-flag"></i> Meta SLA: 1 hora (Prioridad Crítica)</div>
                            <div><i class="bi bi-speedometer"></i> Tiempo respuesta: 5 minutos (OK)</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-4">
            <div class="col-lg-8">
                <!-- Descripción Original -->
                <div class="card-glass mb-4">
                    <div class="card-glass-header">
                        <h3 class="text-xl font-bold mb-0"><i class="bi bi-file-earmark-text"></i> Información del Incidente</h3>
                    </div>
                    <div class="card-glass-body">
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <div class="text-xs text-glass-muted">Cliente</div>
                                <div class="font-bold text-white">Banco Central</div>
                            </div>
                            <div class="col-md-6">
                                <div class="text-xs text-glass-muted">Reportado por</div>
                                <div class="font-bold text-white">María González (Gerente TI)</div>
                            </div>
                            <div class="col-md-6">
                                <div class="text-xs text-glass-muted">Email de Contacto</div>
                                <div class="font-bold text-white">maria.gonzalez@bancocentral.com</div>
                            </div>
                            <div class="col-md-6">
                                <div class="text-xs text-glass-muted">Teléfono</div>
                                <div class="font-bold text-white">+51 999-888-777</div>
                            </div>
                        </div>
                        <hr class="border-white border-opacity-20">
                        <h4 class="text-white mb-2">Descripción Detallada</h4>
                        <p class="mb-3">El sistema de procesamiento de pagos ha caído completamente desde las 09:00 AM. Todos los intentos de transacción generan error de timeout. El sistema no responde y está afectando gravemente las operaciones del banco. Se requiere atención inmediata.</p>
                        <div class="text-sm text-glass-muted">
                            <i class="bi bi-calendar3"></i> Creado: 15/11/2025 09:08 AM | 
                            <i class="bi bi-globe"></i> Origen: Llamada Telefónica
                        </div>
                    </div>
                </div>

                <!-- Req 7 y 8: Historial Completo con Trazabilidad (CM) y Chat (CDT) -->
                <div class="card-glass mb-4">
                    <div class="card-glass-header bg-gradient-primary">
                        <h3 class="text-xl font-bold mb-0">
                            <i class="bi bi-clock-history"></i> Trazabilidad Completa (Auditoría Inmutable)
                        </h3>
                    </div>
                    <div class="card-glass-body">
                        <div class="timeline-modern">
                            <!-- Nota Interna del Agente -->
                            <div class="timeline-item-modern agent">
                                <div class="text-sm text-glass-muted mb-2">
                                    <i class="bi bi-clock"></i> 15/11/2025 10:00 AM | 
                                    <strong>Agente Juan Pérez</strong> | 
                                    <span class="badge-modern" style="background: var(--gradient-warning); color: white;">
                                        <i class="bi bi-lock-fill"></i> NOTA INTERNA
                                    </span>
                                </div>
                                <div class="timeline-bubble" style="border-left: 4px solid #f2994a;">
                                    <div class="bg-warning bg-opacity-10 p-3 rounded">
                                        <strong class="text-warning">Diagnóstico Interno:</strong>
                                        <p class="mb-2 mt-2">Problema identificado en el servidor de base de datos principal. El servicio MySQL se detuvo por falta de memoria. Procediendo a reiniciar y aumentar recursos asignados.</p>
                                        <small class="text-xs">Esta nota NO es visible para el cliente</small>
                                    </div>
                                </div>
                            </div>

                            <!-- Mensaje al Cliente -->
                            <div class="timeline-item-modern agent">
                                <div class="text-sm text-glass-muted mb-2">
                                    <i class="bi bi-clock"></i> 15/11/2025 09:45 AM | 
                                    <strong>Agente Juan Pérez</strong>
                                </div>
                                <div class="timeline-bubble">
                                    <div class="bg-info bg-opacity-10 border border-info border-opacity-50 rounded p-3">
                                        <p class="mb-0">Hemos identificado el problema y estamos trabajando en la solución. Estimamos tener el sistema operativo en los próximos 15-20 minutos. Les mantendremos informados del progreso.</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Mensaje del Cliente -->
                            <div class="timeline-item-modern client">
                                <div class="text-sm text-glass-muted mb-2">
                                    <i class="bi bi-clock"></i> 15/11/2025 09:30 AM | 
                                    <strong>Cliente (María González)</strong>
                                </div>
                                <div class="timeline-bubble">
                                    <p class="mb-0">Urgente: El sistema sigue caído. Nuestras operaciones están completamente paralizadas. Necesitamos una solución inmediata.</p>
                                </div>
                            </div>

                            <!-- Req 6: Asignación Automática -->
                            <div class="timeline-item-modern system">
                                <div class="text-sm text-glass-muted mb-2">
                                    <i class="bi bi-clock"></i> 15/11/2025 09:13 AM | 
                                    <strong>Sistema Automático (Ruteo IRP)</strong>
                                </div>
                                <div class="timeline-bubble">
                                    <div class="bg-success bg-opacity-10 p-3 rounded">
                                        <p class="mb-2 text-sm">
                                            <i class="bi bi-gear-fill"></i> <strong>Asignación Automática Ejecutada:</strong>
                                        </p>
                                        <ul class="text-sm mb-0 pl-4">
                                            <li>Clasificado como: <strong>Incidente - Módulo Pagos</strong></li>
                                            <li>Prioridad detectada: <strong>CRÍTICA</strong> (por palabras clave y cliente tipo A)</li>
                                            <li>Asignado a: <strong>Juan Pérez</strong> (Grupo Infraestructura)</li>
                                            <li>SLA aplicado: <strong>1 hora respuesta / 4 horas resolución</strong></li>
                                            <li>Regla aplicada: <strong>RULE-001: Incidentes Críticos Pagos → Infraestructura</strong></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- Req 2: Registro Único de Incidente -->
                            <div class="timeline-item-modern system">
                                <div class="text-sm text-glass-muted mb-2">
                                    <i class="bi bi-clock"></i> 15/11/2025 09:08 AM | 
                                    <strong>Sistema Novatronic</strong>
                                </div>
                                <div class="timeline-bubble">
                                    <p class="mb-0 text-sm">
                                        <i class="bi bi-plus-circle-fill"></i> Ticket creado con ID único: <strong>NOV-3421</strong>
                                        <br>Origen: Entrada manual (Llamada telefónica registrada por operador)
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Req 8: Chat de Comunicación (CDT) -->
                <div class="card-glass mb-4">
                    <div class="card-glass-header">
                        <ul class="nav nav-tabs border-0" role="tablist">
                            <li class="nav-item">
                                <button class="nav-link active text-white" data-bs-toggle="tab" data-bs-target="#tabPublico">
                                    <i class="bi bi-chat-dots"></i> Mensaje al Cliente
                                </button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-link text-white" data-bs-toggle="tab" data-bs-target="#tabInterno">
                                    <i class="bi bi-lock"></i> Nota Interna (Privada)
                                </button>
                            </li>
                        </ul>
                    </div>
                    <div class="card-glass-body">
                        <div class="tab-content">
                            <div class="tab-pane fade show active" id="tabPublico">
                                <textarea class="form-glass w-full mb-3" rows="4" placeholder="Escriba un mensaje para el cliente. Se registrará en el historial y se enviará por correo..."></textarea>
                                <button class="btn btn-nova btn-nova-primary">
                                    <i class="bi bi-send-fill"></i> Enviar Mensaje al Cliente
                                </button>
                            </div>
                            <div class="tab-pane fade" id="tabInterno">
                                <div class="alert-glass alert-glass-warning mb-3">
                                    <small><i class="bi bi-info-circle"></i> Las notas internas NO son visibles para el cliente. Use este espacio para comunicación entre técnicos.</small>
                                </div>
                                <textarea class="form-glass w-full mb-3" rows="4" placeholder="Escriba una nota interna para el equipo técnico..."></textarea>
                                <button class="btn btn-nova" style="background: var(--gradient-warning); color: white;">
                                    <i class="bi bi-journal-text"></i> Añadir Nota Interna
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Req 19: Vincular Solución a Base de Conocimiento (OPD) -->
                <div class="card-glass">
                    <div class="card-glass-header bg-gradient-success">
                        <h3 class="text-xl font-bold mb-0">
                            <i class="bi bi-book"></i> Vincular a Base de Conocimiento
                        </h3>
                    </div>
                    <div class="card-glass-body">
                        <p class="text-glass-muted mb-3">Al cerrar el ticket, vincule la solución a un artículo de la base de conocimiento para futuras referencias.</p>
                        <select class="form-glass w-full mb-3">
                            <option value="">Seleccionar artículo existente o crear nuevo...</option>
                            <option value="kb-001">KB-001: Reinicio de servicio MySQL tras OOM</option>
                            <option value="kb-015">KB-015: Escalado vertical de recursos BD</option>
                            <option value="new">+ Crear nuevo artículo en Base de Conocimiento</option>
                        </select>
                        <div class="flex gap-2">
                            <button class="btn btn-nova btn-nova-success flex-1">
                                <i class="bi bi-link-45deg"></i> Vincular Artículo
                            </button>
                            <a href="/admin/base-conocimiento" class="btn btn-nova" style="background: var(--gradient-info); color: white;">
                                <i class="bi bi-book"></i> Ver Base Conocimiento
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar de Gestión -->
            <div class="col-lg-4">
                <!-- Panel de Control -->
                <div class="card-glass sticky-card mb-4">
                    <div class="card-glass-header bg-gradient-primary">
                        <h3 class="text-lg font-bold mb-0"><i class="bi bi-sliders"></i> Panel de Control</h3>
                    </div>
                    <div class="card-glass-body">
                        <!-- Cambio de Estado -->
                        <div class="mb-4">
                            <label class="form-label-glass">Cambiar Estado</label>
                            <select class="form-glass w-full mb-2" id="estadoSelect">
                                <option value="proceso" selected>En Proceso</option>
                                <option value="pendiente-cliente">Pendiente Cliente</option>
                                <option value="resuelto">Resuelto</option>
                                <option value="cerrado">Cerrado</option>
                            </select>
                            <button class="btn btn-nova btn-nova-primary w-full">
                                <i class="bi bi-arrow-repeat"></i> Actualizar Estado
                            </button>
                        </div>

                        <hr class="border-white border-opacity-20">

                        <!-- Reasignación -->
                        <div class="mb-4">
                            <label class="form-label-glass">Reasignar Ticket</label>
                            <select class="form-glass w-full mb-2">
                                <option value="juan" selected>Juan Pérez (actual)</option>
                                <option value="laura">Laura Gómez</option>
                                <option value="pedro">Pedro Ríos</option>
                                <option value="grupo">Grupo Infraestructura</option>
                            </select>
                            <button class="btn btn-nova w-full" style="background: var(--gradient-info); color: white;">
                                <i class="bi bi-person-plus"></i> Reasignar
                            </button>
                        </div>

                        <hr class="border-white border-opacity-20">

                        <!-- Acciones Críticas -->
                        <div class="d-grid gap-2">
                            <button class="btn btn-nova btn-nova-success" data-bs-toggle="modal" data-bs-target="#modalCerrar">
                                <i class="bi bi-check-circle-fill"></i> Cerrar Ticket
                            </button>
                            <button class="btn btn-nova btn-nova-danger">
                                <i class="bi bi-arrow-up-circle"></i> Escalar a Supervisor
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Metadatos -->
                <div class="card-glass mb-4">
                    <div class="card-glass-header">
                        <h3 class="text-lg font-bold mb-0"><i class="bi bi-info-circle"></i> Metadatos</h3>
                    </div>
                    <div class="card-glass-body">
                        <div class="space-y-3">
                            <div class="p-3 rounded-lg" style="background: rgba(255,255,255,0.05);">
                                <div class="text-xs text-glass-muted mb-1">ID Único</div>
                                <div class="font-bold text-white">NOV-3421</div>
                            </div>
                            <div class="p-3 rounded-lg" style="background: rgba(255,255,255,0.05);">
                                <div class="text-xs text-glass-muted mb-1">Tipo (IRP)</div>
                                <div class="font-bold text-white">Incidente</div>
                            </div>
                            <div class="p-3 rounded-lg" style="background: rgba(255,255,255,0.05);">
                                <div class="text-xs text-glass-muted mb-1">Categoría (OPD)</div>
                                <div class="font-bold text-white">Módulo Pagos</div>
                            </div>
                            <div class="p-3 rounded-lg" style="background: rgba(255,255,255,0.05);">
                                <div class="text-xs text-glass-muted mb-1">Asignado a</div>
                                <div class="font-bold text-white">Juan Pérez</div>
                                <div class="text-xs text-glass-muted">Grupo Infraestructura</div>
                            </div>
                            <div class="p-3 rounded-lg" style="background: rgba(255,255,255,0.05);">
                                <div class="text-xs text-glass-muted mb-1">Creado</div>
                                <div class="font-bold text-white">15/11/2025 09:08 AM</div>
                            </div>
                            <div class="p-3 rounded-lg" style="background: rgba(255,255,255,0.05);">
                                <div class="text-xs text-glass-muted mb-1">Última Modificación</div>
                                <div class="font-bold text-white">15/11/2025 10:00 AM</div>
                                <div class="text-xs text-glass-muted">por Juan Pérez</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SLA Detallado -->
                <div class="card-glass">
                    <div class="card-glass-header bg-gradient-danger">
                        <h3 class="text-lg font-bold mb-0"><i class="bi bi-stopwatch"></i> SLA Detallado</h3>
                    </div>
                    <div class="card-glass-body">
                        <div class="mb-3">
                            <div class="flex justify-between mb-2">
                                <span class="text-glass-muted">Tiempo Respuesta</span>
                                <span class="text-success font-bold">✓ 5 min</span>
                            </div>
                            <div class="w-full bg-white bg-opacity-10 rounded-full h-2">
                                <div class="bg-gradient-success h-2 rounded-full" style="width: 15%;"></div>
                            </div>
                            <small class="text-xs text-glass-muted">Meta: 30 min (Cumplido)</small>
                        </div>
                        <div>
                            <div class="flex justify-between mb-2">
                                <span class="text-glass-muted">Tiempo Resolución</span>
                                <span class="text-danger font-bold">✗ 52 min</span>
                            </div>
                            <div class="w-full bg-white bg-opacity-10 rounded-full h-2">
                                <div class="bg-gradient-danger h-2 rounded-full" style="width: 87%;"></div>
                            </div>
                            <small class="text-xs text-danger">Meta: 1 hora (8 min restantes)</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Cerrar Ticket -->
    <div class="modal fade" id="modalCerrar" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" style="background: var(--glass-bg); backdrop-filter: blur(16px); border: 1px solid var(--glass-border); color: white;">
                <div class="modal-header border-0">
                    <h5 class="modal-title"><i class="bi bi-check-circle text-success"></i> Cerrar Ticket NOV-3421</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label-glass">Resumen de la Solución Implementada</label>
                        <textarea class="form-glass w-full" rows="4" placeholder="Describa la solución aplicada y las acciones realizadas..."></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label-glass">Tiempo Total de Resolución</label>
                        <input type="text" class="form-glass w-full" value="52 minutos" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label-glass">Cumplimiento de SLA</label>
                        <select class="form-glass w-full">
                            <option value="cumplido" selected>✓ Cumplido (dentro del tiempo)</option>
                            <option value="incumplido">✗ Incumplido (fuera de tiempo)</option>
                        </select>
                    </div>
                    <div class="alert-glass alert-glass-success">
                        <small><i class="bi bi-info-circle"></i> Al cerrar el ticket, se enviará un correo de confirmación al cliente con el resumen de la solución.</small>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-nova" style="background: rgba(255,255,255,0.1); color: white;" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-nova btn-nova-success">
                        <i class="bi bi-check-circle-fill"></i> Confirmar Cierre
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>